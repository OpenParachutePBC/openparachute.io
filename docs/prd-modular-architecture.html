<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD: Modular Architecture | Parachute Documentation</title>
    <meta name="description" content="Product Requirements Document for restructuring Parachute as a modular personal computer platform">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="docs.css">
    <style>
        /* PRD-specific styles */
        .prd-header {
            background: linear-gradient(135deg, rgba(107, 159, 255, 0.1) 0%, rgba(107, 255, 159, 0.05) 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .prd-header h1 {
            margin-bottom: 0.5rem;
        }
        .prd-meta {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--fg-muted);
        }
        .prd-meta strong {
            color: var(--fg);
        }
        .prd-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 179, 71, 0.2);
            color: #ffb347;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        .principle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .principle-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
        }
        .principle-card h4 {
            margin: 0 0 0.5rem 0;
            color: var(--accent);
            font-size: 1rem;
        }
        .principle-card p {
            margin: 0;
            font-size: 0.9rem;
        }
        .toc {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .toc h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: var(--fg);
        }
        .toc ol {
            margin: 0;
            padding-left: 1.5rem;
        }
        .toc li {
            margin-bottom: 0.5rem;
        }
        .toc a {
            color: var(--fg-muted);
            text-decoration: none;
        }
        .toc a:hover {
            color: var(--accent);
        }
        .module-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .module-card h4 {
            margin: 0 0 0.5rem 0;
            color: var(--fg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .module-card .module-icon {
            font-size: 1.5rem;
        }
        .module-card .module-type {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: var(--accent);
            color: var(--bg);
            border-radius: 4px;
            font-weight: 500;
        }
        .module-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .module-features span {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background: rgba(107, 159, 255, 0.1);
            color: var(--accent);
            border-radius: 4px;
        }
        .phase-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .phase-card h4 {
            margin: 0 0 0.5rem 0;
            color: var(--fg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .phase-card .phase-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--accent);
            color: var(--bg);
            border-radius: 50%;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .phase-card .phase-weeks {
            font-size: 0.8rem;
            color: var(--fg-muted);
            margin-left: auto;
        }
        .question-list {
            counter-reset: question;
        }
        .question-list li {
            counter-increment: question;
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1rem;
        }
        .question-list li::before {
            content: counter(question);
            position: absolute;
            left: 0;
            top: 0;
            width: 1.5rem;
            height: 1.5rem;
            background: rgba(107, 159, 255, 0.2);
            color: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        .comparison-side {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
        }
        .comparison-side h4 {
            margin-top: 0;
            color: var(--accent);
            font-size: 1rem;
        }
        .comparison-side pre {
            font-size: 0.75rem;
            line-height: 1.5;
            color: var(--fg-muted);
            margin: 0;
        }
        @media (max-width: 900px) {
            .principle-grid {
                grid-template-columns: 1fr;
            }
            .comparison-table {
                grid-template-columns: 1fr;
            }
            .prd-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="../index.html" class="logo">Open Parachute</a>
            <div class="nav-links">
                <a href="index.html" class="active">Docs</a>
                <a href="../roadmap.html">Roadmap</a>
                <a href="https://github.com/OpenParachutePBC" target="_blank">GitHub</a>
            </div>
        </nav>
    </header>
    <div class="docs-layout">
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <h3>Overview</h3>
                <a href="index.html">Architecture</a>
                <a href="data-flow.html">Data Flow</a>
                <a href="integration.html">Integration</a>
            </div>
            <div class="sidebar-section">
                <h3>App (Flutter)</h3>
                <a href="app-overview.html">Overview</a>
                <a href="app-chat.html">Chat Feature</a>
                <a href="app-daily.html">Daily Feature</a>
                <a href="app-vault.html">Vault Feature</a>
                <a href="app-services.html">Services</a>
            </div>
            <div class="sidebar-section">
                <h3>Base (Python)</h3>
                <a href="base-overview.html">Overview</a>
                <a href="base-api.html">API Routes</a>
                <a href="base-orchestrator.html">Orchestrator</a>
                <a href="base-agents.html">Agents</a>
                <a href="base-database.html">Database</a>
            </div>
            <div class="sidebar-section">
                <h3>Planning</h3>
                <a href="prd-modular-architecture.html" class="active">PRD: Modular Architecture</a>
            </div>
            <div class="sidebar-section">
                <h3>Reference</h3>
                <a href="issues.html">Issues &amp; TODOs</a>
                <a href="file-manifest.html">File Manifest</a>
            </div>
        </aside>
        <main class="docs-content">
            <div class="breadcrumb">
                <a href="../index.html">Home</a> / <a href="index.html">Docs</a> / <span>PRD: Modular Architecture</span>
            </div>

            <!-- Header -->
            <div class="prd-header">
                <span class="prd-status">Draft</span>
                <h1>PRD: Modular Parachute Computer</h1>
                <p class="lead">Restructuring Parachute from a monolithic application into a modular personal computer platform.</p>
                <div class="prd-meta">
                    <span><strong>Version:</strong> 0.1.0</span>
                    <span><strong>Date:</strong> January 29, 2026</span>
                    <span><strong>Author:</strong> Aaron Gabriel</span>
                </div>
            </div>

            <!-- Table of Contents -->
            <div class="toc">
                <h3>Contents</h3>
                <ol>
                    <li><a href="#vision">Vision &amp; Principles</a></li>
                    <li><a href="#architecture">Architecture Overview</a></li>
                    <li><a href="#core">Parachute Computer Core</a></li>
                    <li><a href="#brain">Brain: The Connective Layer</a></li>
                    <li><a href="#modules">Module System</a></li>
                    <li><a href="#core-modules">Core Modules (Daily, Chat)</a></li>
                    <li><a href="#flutter">Flutter App Architecture</a></li>
                    <li><a href="#sandboxing">Sandboxing &amp; Permissions</a></li>
                    <li><a href="#communication">Inter-Module Communication</a></li>
                    <li><a href="#hooks">Hooks System</a></li>
                    <li><a href="#migration">Migration Plan</a></li>
                    <li><a href="#questions">Open Questions</a></li>
                </ol>
            </div>

            <!-- Executive Summary -->
            <section class="docs-section">
                <h2>Executive Summary</h2>
                <p>Parachute is evolving from a monolithic application into a <strong>modular personal computer platform</strong>. This PRD defines the architecture for:</p>
                <ul>
                    <li><strong>Parachute Computer</strong> - The foundational platform (Python server + management UI)</li>
                    <li><strong>Brain</strong> - Integrated connective layer for knowledge, context, and memory</li>
                    <li><strong>Module System</strong> - Discoverable modules that extend functionality (all modules are vault modules)</li>
                    <li><strong>Core Modules</strong> - Daily and Chat as the first installable modules</li>
                    <li><strong>Flutter App Architecture</strong> - Shared <code>parachute_core</code> package with separate apps</li>
                </ul>
                <div class="callout callout-info">
                    <strong>The Goal:</strong> Create a truly personal computer where the core platform rarely changes, but users can extend functionality through modules living in their vault.
                </div>
            </section>

            <!-- Vision & Principles -->
            <section class="docs-section" id="vision">
                <h2>Vision &amp; Principles</h2>

                <h3>The Core Insight</h3>
                <p><strong>Parachute Computer should be a platform, not an application.</strong></p>
                <p>The current monolith tightly couples Chat, Daily, and Vault. This restructuring inverts the relationship: Parachute Computer becomes the foundation, and modules plug into it.</p>

                <h3>Guiding Principles</h3>
                <div class="principle-grid">
                    <div class="principle-card">
                        <h4>Vault-Centric</h4>
                        <p>The user's vault (<code>~/Parachute</code>) is the source of truth. Modules, configurations, and data live there. The platform serves the vault.</p>
                    </div>
                    <div class="principle-card">
                        <h4>Local-First</h4>
                        <p>Everything runs on the user's machine. No cloud dependency. Data never leaves without explicit action.</p>
                    </div>
                    <div class="principle-card">
                        <h4>Module Independence</h4>
                        <p>Modules can be developed, tested, and deployed independently. A bug in one module shouldn't crash others.</p>
                    </div>
                    <div class="principle-card">
                        <h4>Progressive Disclosure</h4>
                        <p>The default experience is simple (Daily + Chat). Power users can add modules, configure permissions, build their own.</p>
                    </div>
                    <div class="principle-card">
                        <h4>Interoperability</h4>
                        <p>Modules communicate through standard interfaces (HTTP, MCP). No tight coupling between modules.</p>
                    </div>
                    <div class="principle-card">
                        <h4>User Ownership</h4>
                        <p>Users own their modules. They can inspect, modify, fork, and share them freely.</p>
                    </div>
                </div>
            </section>

            <!-- Architecture Overview -->
            <section class="docs-section" id="architecture">
                <h2>Architecture Overview</h2>
                <div class="architecture-visual">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flutter Apps (Separate Packages)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Parachute Daily â”‚  â”‚ Parachute Chat  â”‚  â”‚ Parachute Computer          â”‚  â”‚
â”‚  â”‚ (journaling)    â”‚  â”‚ (conversation)  â”‚  â”‚ (module management)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                    â”‚                         â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    parachute_core (Flutter package)                    â”‚  â”‚
â”‚  â”‚  â€¢ Server connection   â€¢ Auth/API keys     â€¢ Theming/Design tokens    â”‚  â”‚
â”‚  â”‚  â€¢ Common widgets      â€¢ Sync service      â€¢ Transcription (optional) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                HTTP/SSE
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Parachute Computer (Python Server)                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         Core Router (FastAPI)                          â”‚ â”‚
â”‚  â”‚  /api/brain/*    â†’ Brain (integrated)                                  â”‚ â”‚
â”‚  â”‚  /api/modules/*  â†’ Module Management                                   â”‚ â”‚
â”‚  â”‚  /api/daily/*    â†’ Daily Module                                        â”‚ â”‚
â”‚  â”‚  /api/chat/*     â†’ Chat Module                                         â”‚ â”‚
â”‚  â”‚  /api/{custom}/* â†’ User-defined Modules                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    parachute.core (Python package)                     â”‚ â”‚
â”‚  â”‚  â€¢ Claude SDK wrapper      â€¢ Module discovery & lifecycle              â”‚ â”‚
â”‚  â”‚  â€¢ Brain (knowledge layer) â€¢ Database layer (SQLite)                   â”‚ â”‚
â”‚  â”‚  â€¢ File access (gated)     â€¢ MCP infrastructure                        â”‚ â”‚
â”‚  â”‚  â€¢ Hooks system            â€¢ Event bus                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Modules (all vault modules)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Daily       â”‚  â”‚ Chat        â”‚  â”‚ Telegram    â”‚  â”‚ Custom     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (Parachute) â”‚  â”‚ (Parachute) â”‚  â”‚ Bot         â”‚  â”‚ Modules    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ verified    â”‚  â”‚ verified    â”‚  â”‚ user        â”‚  â”‚            â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚ Trusted modules in main container â”‚                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Agent Sandboxes (Docker per untrusted agent)             â”‚   â”‚
â”‚  â”‚  Claude SDK runs with scoped permissions per agent definition         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                            ~/Parachute (vault)</pre>
                </div>

                <h3>Key Architectural Changes</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Current</th>
                            <th>Future</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Single monolithic Flutter app</td>
                            <td>Multiple apps sharing <code>parachute_core</code> package</td>
                        </tr>
                        <tr>
                            <td>Hardcoded features (Chat, Daily, Vault)</td>
                            <td>Discoverable modules that register routes</td>
                        </tr>
                        <tr>
                            <td>Lima VM for isolation</td>
                            <td>Bare metal + Docker containers for sandboxing</td>
                        </tr>
                        <tr>
                            <td>Settings screen for configuration</td>
                            <td>Parachute Computer UI for module management</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Parachute Computer Core -->
            <section class="docs-section" id="core">
                <h2>Parachute Computer Core</h2>
                <p>The core platform provides foundational services that all modules depend on.</p>

                <h3>Core Services</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Purpose</th>
                            <th>Access</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Claude SDK Wrapper</strong></td>
                            <td>Unified interface to Claude Agent SDK with HOME override for vault-portable sessions</td>
                            <td>All modules</td>
                        </tr>
                        <tr>
                            <td><strong>Permission Handler</strong></td>
                            <td>Enforce read/write/bash permissions per module</td>
                            <td>All modules</td>
                        </tr>
                        <tr>
                            <td><strong>Database Layer</strong></td>
                            <td>SQLite operations (sessions, metadata, chunks)</td>
                            <td>Via core API</td>
                        </tr>
                        <tr>
                            <td><strong>File Access</strong></td>
                            <td>Gated filesystem operations respecting permissions</td>
                            <td>Per-module</td>
                        </tr>
                        <tr>
                            <td><strong>MCP Infrastructure</strong></td>
                            <td>Spawn and manage MCP servers for agent tools</td>
                            <td>Module-declared</td>
                        </tr>
                        <tr>
                            <td><strong>Event Bus</strong></td>
                            <td>Publish/subscribe for cross-module events</td>
                            <td>All modules</td>
                        </tr>
                        <tr>
                            <td><strong>Module Discovery</strong></td>
                            <td>Find, load, validate modules from config</td>
                            <td>Core only</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Configuration</h3>
                <p>Module registry at <code>~/.parachute/modules.yaml</code>:</p>
                <div class="code-block">
                    <div class="code-header">modules.yaml</div>
                    <pre><code># All modules are vault modules - no "built-in" distinction
# Fresh vault starts empty, user installs what they want
modules:
  daily:
    enabled: true
    source: parachute://daily    # Official Parachute module
    version: "1.0.0"
    trust: verified              # Signed by Parachute
    hash: "sha256:abc123..."     # Verified on load

  chat:
    enabled: true
    source: parachute://chat
    version: "1.0.0"
    trust: verified
    hash: "sha256:def456..."

  telegram-bot:
    enabled: true
    source: local                # User-created in vault
    path: "Modules/telegram-bot"
    trust: trusted               # User explicitly trusts
    hash: "sha256:789abc..."     # Re-approve if changes
    agents:                      # Agent-level sandboxing
      responder:
        paths: ["Brain/projects/client-x.md", "Work/client-x/"]
        capabilities: [read]
      admin:
        paths: ["Brain/**"]
        capabilities: [read, write]

  experimental-module:
    enabled: true
    source: github://someuser/cool-module
    version: "0.1.0"
    trust: untrusted             # Runs in separate container
    hash: "sha256:xyz789..."</code></pre>
                </div>
            </section>

            <!-- Brain: The Connective Layer -->
            <section class="docs-section" id="brain">
                <h2>Brain: The Connective Layer</h2>
                <p>Brain isn't just another moduleâ€”it's <strong>integrated into the core</strong> as the connective tissue between all modules. It provides the shared context layer that enables intelligent cross-module communication.</p>

                <div class="callout callout-info">
                    <strong>Key Insight:</strong> Brain connects Daily and Chat (and future modules) through shared knowledge, context, and memory. It's not optional infrastructureâ€”it's foundational.
                </div>

                <h3>Brain as Core Infrastructure</h3>
                <div class="architecture-visual">
                    <pre>
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           Daily Module              â”‚
                    â”‚  â€¢ Creates journal entries          â”‚
                    â”‚  â€¢ Detects entity mentions          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BRAIN (Core)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Entity    â”‚  â”‚   Para-ID   â”‚  â”‚  Relation   â”‚  â”‚  Context    â”‚ â”‚
â”‚  â”‚   Store     â”‚  â”‚   System    â”‚  â”‚   Graph     â”‚  â”‚  Provider   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  ~/Parachute/Brain/                                                  â”‚
â”‚    types.yaml          # Dynamic entity type definitions             â”‚
â”‚    entities/           # Markdown files per entity                   â”‚
â”‚      people/           # Person entities                             â”‚
â”‚      projects/         # Project entities (can point to folders)     â”‚
â”‚      topics/           # Topic entities                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           Chat Module               â”‚
                    â”‚  â€¢ Loads context from Brain         â”‚
                    â”‚  â€¢ Updates Brain after sessions     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                </div>

                <h3>The Daily â†’ Brain â†’ Chat Flow</h3>
                <p>Here's how knowledge flows through the system:</p>

                <div class="module-card">
                    <h4>1. Daily Creates Entry</h4>
                    <p>You journal: <em>"Met with Kevin about the LVB curriculum. He suggested we add a module on prompt engineering."</em></p>
                </div>

                <div class="module-card">
                    <h4>2. Brain Detects Mentions</h4>
                    <p>Agent (via hook) scans entry and finds:</p>
                    <ul>
                        <li><code>Kevin</code> â†’ resolves to <code>person-abc123</code> (Kevin from Regen Hub)</li>
                        <li><code>LVB</code> â†’ resolves to <code>project-def456</code> (Learn Vibe Build)</li>
                        <li><code>prompt engineering</code> â†’ no match, suggests creating topic</li>
                    </ul>
                    <p>Brain auto-links the entry and optionally updates entity files with new context.</p>
                </div>

                <div class="module-card">
                    <h4>3. Chat Loads Context</h4>
                    <p>Later, you open Chat and mention "working on LVB". A hook detects this and:</p>
                    <ul>
                        <li>Loads <code>Brain/projects/learn-vibe-build.md</code> into context</li>
                        <li>Loads recent Daily entries mentioning LVB</li>
                        <li>If the entity points to <code>~/Projects/lvb/</code>, loads that project's AGENTS.md</li>
                    </ul>
                </div>

                <div class="module-card">
                    <h4>4. Brain Updates from Chat</h4>
                    <p>After the chat, a hook asks: "Update Brain with new information?" New facts about Kevin or LVB get written back to their entity files.</p>
                </div>

                <h3>Entities Can Point to External Work</h3>
                <p>Project entities can reference folders outside the vault, enabling context-aware assistance:</p>
                <div class="code-block">
                    <div class="code-header">Brain/entities/projects/parachute.md</div>
                    <pre><code>---
para_id: project-parachute
type: project
status: active
work_path: ~/Projects/parachute    # External folder
agents_path: ~/Projects/parachute/CLAUDE.md
aliases:
  - Parachute
  - parachute project
  - the vault app
tags:
  - open-source
  - flutter
  - python
---

# Parachute

Open & interoperable extended mind technology.

## Quick Context
- Flutter app + Python base server
- Working on modular architecture restructure
- See [[learn-vibe-build]] for related teaching

## Relationships
- [[aaron-gabriel]] - Founder
- [[kevin-regen-hub]] - Advisor on distribution</code></pre>
                </div>

                <h3>Dynamic Entity Types</h3>
                <p>Entity types are not hardcoded. Users start with sensible defaults but can create their own. Daily can suggest new types based on journal content.</p>
                <div class="code-block">
                    <div class="code-header">Brain/types.yaml</div>
                    <pre><code>types:
  person:
    icon: "ğŸ‘¤"
    folder: "people"
    fields: [aliases, tags, relationships]

  project:
    icon: "ğŸ“"
    folder: "projects"
    fields: [status, work_path, aliases, tags, relationships]

  topic:
    icon: "ğŸ’¡"
    folder: "topics"
    fields: [aliases, tags]

  resource:
    icon: "ğŸ“š"
    folder: "resources"
    fields: [url, aliases, tags]

  # User-defined types
  organization:
    icon: "ğŸ¢"
    folder: "organizations"
    fields: [type, aliases, tags, relationships]

  event:
    icon: "ğŸ“…"
    folder: "events"
    fields: [date, location, attendees]</code></pre>
                </div>

                <h3>Brain MCP Tools</h3>
                <p>Available to all modules and agents:</p>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>brain-search</code></td>
                            <td>Semantic search across all entities</td>
                        </tr>
                        <tr>
                            <td><code>brain-resolve</code></td>
                            <td>Resolve text mention to para_id (alias resolution)</td>
                        </tr>
                        <tr>
                            <td><code>brain-link</code></td>
                            <td>Create wiki-style link between entries and entities</td>
                        </tr>
                        <tr>
                            <td><code>brain-suggest</code></td>
                            <td>Suggest entities/types based on text content</td>
                        </tr>
                        <tr>
                            <td><code>brain-types</code></td>
                            <td>List/create/modify entity types</td>
                        </tr>
                        <tr>
                            <td><code>brain-context</code></td>
                            <td>Load entity files + related context for a topic</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Module System -->
            <section class="docs-section" id="modules">
                <h2>Module System</h2>
                <p>All modules are vault modules. A fresh vault starts emptyâ€”Parachute Computer offers to install official modules (Daily, Chat) during onboarding, but they install into the vault just like any other module.</p>

                <div class="code-block">
                    <div class="code-header">module.py - Module Definition</div>
                    <pre><code>from parachute.core import Module, route, mcp_tool, event
from parachute.core.brain import brain  # Direct import - Brain is core

class DailyModule(Module):
    """Daily journaling and reflection module."""

    name = "daily"
    version = "1.0.0"
    description = "Voice-first journaling with agent reflections"

    # Declare required permissions
    permissions = {
        "read": ["Daily/**", "parachute/memory.md"],
        "write": ["Daily/**"],
        "bash": False,
        "mcp": ["daily-journal", "daily-search"],
    }

    # HTTP Routes (exposed at /api/daily/*)
    @route("GET", "/entries")
    async def list_entries(self, date: str = None, limit: int = 50):
        """List journal entries."""
        ...

    @route("POST", "/query")
    async def query_streaming(self, message: str, session_id: str = None):
        """Stream a conversation about journal entries."""
        async for event in self.core.query(
            message=message,
            session_id=session_id,
            mcp_servers=self.get_mcp_servers(),
        ):
            yield event

    # MCP Tools (exposed to Claude agent)
    @mcp_tool("daily-journal")
    async def search_journals(self, query: str, date_from: str = None):
        """Search journal entries by content."""
        ...

    # Event handlers
    @event("daily.entry.created")
    async def on_entry_created(self, entry_id: str, content: str):
        """Handle new journal entry - trigger reflection pipeline."""
        # Direct Python call to Brain (it's part of core)
        mentions = await brain.suggest(content)
        for mention in mentions:
            if mention.confidence > 0.8:
                await brain.link(entry_id, mention.para_id)

        await self.trigger_reflection_agent(entry_id)</code></pre>
                </div>

                <h3>Trusted Module Communication</h3>
                <p>Trusted modules can directly import and call each other's Python code (they run in the same process):</p>
                <div class="code-block">
                    <div class="code-header">Direct Python Imports (Trusted Modules)</div>
                    <pre><code># In a trusted module, you can import other trusted modules directly
from parachute.core.brain import brain
from parachute.modules.daily import daily_module

# Direct function calls - no HTTP overhead
entities = await brain.search("Kevin")
entries = await daily_module.get_recent_entries(limit=5)

# This only works for trusted modules in the main container
# Untrusted modules must use the HTTP API</code></pre>
                </div>

                <h3>Module Discovery Flow</h3>
                <ol>
                    <li>Server starts and loads <code>~/.parachute/modules.yaml</code></li>
                    <li>For each enabled module:
                        <ul>
                            <li>If <code>source: builtin</code> â†’ Load from <code>parachute/modules/{name}/</code></li>
                            <li>If <code>source: vault</code> â†’ Load from <code>{vault}/{path}/module.py</code></li>
                        </ul>
                    </li>
                    <li>Validate module class against interface</li>
                    <li>Check permissions against policy</li>
                    <li>Register routes at <code>/api/{name}/*</code></li>
                    <li>Start MCP servers if declared</li>
                    <li>Call <code>on_enable()</code> lifecycle hook</li>
                </ol>
            </section>

            <!-- Core Modules -->
            <section class="docs-section" id="core-modules">
                <h2>Core Modules (Daily, Chat)</h2>
                <p>Official Parachute modules available for easy installation. These are <strong>vault modules</strong> like any otherâ€”just signed and verified by Parachute.</p>

                <div class="callout callout-info">
                    <strong>Fresh Vault Experience:</strong> When you create a new vault, it's empty. Parachute Computer asks "Would you like to install recommended modules?" and offers Daily and Chat. They install into your vault just like any module would.
                </div>

                <div class="module-card">
                    <h4>
                        <span class="module-icon">ğŸ“”</span>
                        Daily Module
                        <span class="module-type">Verified (Parachute)</span>
                    </h4>
                    <p>Voice-first journaling with AI-powered reflections. The foundation of Parachute's "extended mind" experience.</p>
                    <p><strong>Data Location:</strong> <code>~/Parachute/Daily/</code></p>
                    <p><strong>Source:</strong> <code>parachute://daily</code></p>
                    <div class="module-features">
                        <span>Voice transcription</span>
                        <span>Entry management</span>
                        <span>Reflection agents</span>
                        <span>Journal search</span>
                        <span>Brain integration</span>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem;"><strong>MCP Tools:</strong> <code>daily-search</code>, <code>daily-today</code>, <code>daily-create</code></p>
                    <p style="font-size: 0.9rem;"><strong>Events:</strong> <code>daily.entry.created</code>, <code>daily.reflection.completed</code></p>
                </div>

                <div class="module-card">
                    <h4>
                        <span class="module-icon">ğŸ’¬</span>
                        Chat Module
                        <span class="module-type">Verified (Parachute)</span>
                    </h4>
                    <p>Conversational AI interface with agentic capabilities. Session management, context loading, and Brain-aware conversations.</p>
                    <p><strong>Data Location:</strong> <code>~/Parachute/Chat/</code></p>
                    <p><strong>Source:</strong> <code>parachute://chat</code></p>
                    <div class="module-features">
                        <span>Streaming chat</span>
                        <span>Session persistence</span>
                        <span>Context loading</span>
                        <span>Agent selection</span>
                        <span>Brain context</span>
                        <span>Tool permissions</span>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem;"><strong>MCP Tools:</strong> <code>chat-sessions</code>, <code>chat-context</code></p>
                    <p style="font-size: 0.9rem;"><strong>Events:</strong> <code>chat.session.created</code>, <code>chat.session.message</code></p>
                </div>

                <h3>Example: User-Created Module</h3>
                <p>Here's what a Telegram bot module might look likeâ€”with agent-level sandboxing:</p>

                <div class="module-card">
                    <h4>
                        <span class="module-icon">ğŸ¤–</span>
                        Telegram Bot
                        <span class="module-type">User-Created</span>
                    </h4>
                    <p>Custom bot that responds to Telegram messages with context from a specific project.</p>
                    <p><strong>Location:</strong> <code>~/Parachute/Modules/telegram-bot/</code></p>
                    <div class="module-features">
                        <span>Telegram integration</span>
                        <span>Scoped agents</span>
                        <span>Limited Brain access</span>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">Modules/telegram-bot/module.py</div>
                    <pre><code>from parachute.core import Module, route, agent
from parachute.core.brain import brain

class TelegramBotModule(Module):
    name = "telegram-bot"
    version = "0.1.0"

    # Define agents with different sandbox scopes
    agents = {
        "responder": {
            # This agent can only see one project
            "paths": [
                "Brain/projects/client-x.md",
                "~/Work/client-x/"
            ],
            "capabilities": ["read"],
        },
        "admin": {
            # Admin agent has broader access
            "paths": ["Brain/**"],
            "capabilities": ["read", "write"],
        }
    }

    @route("POST", "/webhook")
    async def handle_telegram(self, message: dict):
        # Use the scoped responder agent
        response = await self.run_agent(
            "responder",
            f"Answer this question: {message['text']}"
        )
        return {"reply": response}</code></pre>
                </div>
            </section>

            <!-- Flutter Architecture -->
            <section class="docs-section" id="flutter">
                <h2>Flutter App Architecture</h2>
                <p>The current monolith becomes multiple packages sharing a core.</p>

                <div class="comparison-table">
                    <div class="comparison-side">
                        <h4>Current (Monolith)</h4>
                        <pre>app/
  lib/
    features/
      chat/
      daily/
      vault/
      settings/
    core/
      services/
      providers/</pre>
                    </div>
                    <div class="comparison-side">
                        <h4>Future (Modular)</h4>
                        <pre>app/
  packages/
    parachute_core/      â† Shared
    parachute_daily/     â† Daily-specific
    parachute_chat/      â† Chat-specific
    parachute_computer/  â† Management UI
  apps/
    daily/               â† Standalone app
    chat/                â† Standalone app
    computer/            â† Full app</pre>
                    </div>
                </div>

                <h3>Package Contents</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Package</th>
                            <th>Contents</th>
                            <th>Optional?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>parachute_core</code></td>
                            <td>Server connection, auth, theming, common widgets, sync</td>
                            <td>Required by all</td>
                        </tr>
                        <tr>
                            <td><code>parachute_daily</code></td>
                            <td>Journal UI, voice input, entry management</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>parachute_chat</code></td>
                            <td>Chat UI, session management, message bubbles</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>parachute_computer</code></td>
                            <td>Module management, permissions, settings</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>

                <h3>App Configurations</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>App</th>
                            <th>Packages</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Parachute Daily</strong></td>
                            <td>core + daily</td>
                            <td>Standalone journaling app (what ships first)</td>
                        </tr>
                        <tr>
                            <td><strong>Parachute Chat</strong></td>
                            <td>core + chat</td>
                            <td>Standalone chat app</td>
                        </tr>
                        <tr>
                            <td><strong>Parachute Computer</strong></td>
                            <td>core + daily + chat + computer</td>
                            <td>Full experience with module management</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Sandboxing -->
            <section class="docs-section" id="sandboxing">
                <h2>Sandboxing &amp; Permissions</h2>
                <p>Security through <strong>agent-level sandboxing</strong> (not module-level) and code verification.</p>

                <div class="callout callout-info">
                    <strong>Key Insight:</strong> Modules are trusted Python code that runs in the main process. The sandboxing happens at the <strong>agent level</strong>â€”when Claude SDK runs, that's where containerization and permission scoping matters.
                </div>

                <h3>Module Hash Verification</h3>
                <p>Protects against agents modifying their own module code:</p>
                <div class="code-block">
                    <div class="code-header">modules.yaml - Hash Verification</div>
                    <pre><code>modules:
  telegram-bot:
    source: local
    path: "Modules/telegram-bot"
    trust: trusted
    hash: "sha256:a1b2c3d4e5f6..."  # Computed on first load

# On server restart:
# 1. Compute hash of module.py
# 2. If hash differs from stored â†’ require user re-approval
# 3. This prevents agents from modifying their own code</code></pre>
                </div>
                <p>If a module's code changes (even a single character), the user must re-approve it before it loads. This prevents prompt injection attacks where an agent tries to modify its own permissions.</p>

                <h3>Trust Levels</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Description</th>
                            <th>Behavior</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Verified</strong></td>
                            <td>Signed by Parachute (Daily, Chat)</td>
                            <td>Runs in main container, signature checked</td>
                        </tr>
                        <tr>
                            <td><strong>Trusted</strong></td>
                            <td>User explicitly trusts this module</td>
                            <td>Runs in main container, hash verified</td>
                        </tr>
                        <tr>
                            <td><strong>Untrusted</strong></td>
                            <td>Third-party or experimental</td>
                            <td>Separate container (future), hash verified</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Agent-Level Sandboxing</h3>
                <p>The real sandboxing happens when Claude SDK runs. Modules define <strong>agent types</strong> with scoped permissions:</p>
                <div class="code-block">
                    <div class="code-header">Agent Sandbox Definition</div>
                    <pre><code>class TelegramBotModule(Module):
    # Module runs in main process (trusted)
    # But its AGENTS run in sandboxed containers

    agents = {
        "responder": {
            # Tightly scoped - only sees one project
            "paths": [
                "Brain/projects/client-x.md",
                "~/Work/client-x/"
            ],
            "capabilities": ["read"],
            "bash": False,
            "network": False,
        },
        "admin": {
            # Broader access but still scoped
            "paths": ["Brain/**", "Daily/**"],
            "capabilities": ["read", "write"],
            "bash": ["git", "npm"],
            "network": ["api.telegram.org"],
        }
    }

    async def handle_message(self, text: str):
        # When this runs Claude SDK, it uses the "responder" sandbox
        return await self.run_agent("responder", text)</code></pre>
                </div>

                <h3>Container Architecture</h3>
                <div class="architecture-visual">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Host Machine                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Main Container (Parachute Computer)           â”‚  â”‚
â”‚  â”‚  â€¢ FastAPI server (port 3333)                             â”‚  â”‚
â”‚  â”‚  â€¢ Brain (core)                                           â”‚  â”‚
â”‚  â”‚  â€¢ All trusted modules (loaded as Python)                 â”‚  â”‚
â”‚  â”‚  â€¢ Module hash verification on load                       â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Volumes:                                                 â”‚  â”‚
â”‚  â”‚    /vault     â† ~/Parachute (read-write)                  â”‚  â”‚
â”‚  â”‚    /app       â† Server code (read-only)                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  When Claude SDK runs â†’ spawns agent sandbox              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Agent Sandbox (per Claude SDK run)            â”‚  â”‚
â”‚  â”‚  â€¢ Scoped filesystem access (per agent definition)        â”‚  â”‚
â”‚  â”‚  â€¢ Scoped bash commands (if any)                          â”‚  â”‚
â”‚  â”‚  â€¢ Scoped network access (if any)                         â”‚  â”‚
â”‚  â”‚  â€¢ HOME=/vault for SDK session storage                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                </div>

                <h3>Permission Flow</h3>
                <ol>
                    <li><strong>Module loads</strong> â†’ Hash checked against stored value</li>
                    <li><strong>If hash changed</strong> â†’ User must re-approve</li>
                    <li><strong>Module calls <code>run_agent()</code></strong> â†’ Core looks up agent sandbox definition</li>
                    <li><strong>Claude SDK spawns</strong> â†’ Runs with scoped permissions from agent definition</li>
                    <li><strong>Agent tries to access file</strong> â†’ Permission handler checks against allowed paths</li>
                </ol>
            </section>

            <!-- Inter-Module Communication -->
            <section class="docs-section" id="communication">
                <h2>Inter-Module Communication</h2>
                <p>Multiple patterns for modules to communicate, depending on trust level.</p>

                <h3>Trusted Modules: Direct Python</h3>
                <p>Trusted modules run in the same process and can import each other directly:</p>
                <div class="code-block">
                    <div class="code-header">Direct Python Calls (Zero Overhead)</div>
                    <pre><code># In Daily module
from parachute.core.brain import brain
from parachute.modules.chat import chat_module

# Direct function calls - no serialization, no HTTP
mentions = await brain.suggest(entry_content)
recent_chats = await chat_module.get_sessions(topic="LVB")</code></pre>
                </div>

                <h3>All Modules: Standard Patterns</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Pattern</th>
                            <th>Use Case</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Direct Import</strong></td>
                            <td>Trusted module â†’ trusted module</td>
                            <td><code>from parachute.core.brain import brain</code></td>
                        </tr>
                        <tr>
                            <td><strong>Internal HTTP</strong></td>
                            <td>Untrusted module â†’ any module</td>
                            <td><code>POST /api/brain/resolve</code></td>
                        </tr>
                        <tr>
                            <td><strong>MCP Tools</strong></td>
                            <td>Agent using module capabilities</td>
                            <td>Chat agent calls <code>brain-search</code> tool</td>
                        </tr>
                        <tr>
                            <td><strong>Event Bus</strong></td>
                            <td>Decoupled reactions</td>
                            <td>Hook listens for <code>daily.entry.created</code></td>
                        </tr>
                    </tbody>
                </table>

                <div class="callout callout-info">
                    <strong>Same Machine:</strong> All communication stays local. Direct Python calls have zero overhead. HTTP calls are localhost-only with negligible latency.
                </div>
            </section>

            <!-- Hooks System -->
            <section class="docs-section" id="hooks">
                <h2>Hooks System</h2>
                <p>User-configurable scripts triggered by system events. More flexible than hardcoded curator logic.</p>

                <div class="code-block">
                    <div class="code-header">~/.parachute/hooks/</div>
                    <pre><code>hooks/
â”œâ”€â”€ on-session-start.py    # Load context files, inject memory
â”œâ”€â”€ on-session-end.py      # Summarize to memory, cleanup
â”œâ”€â”€ on-daily-entry.py      # Trigger reflection, link mentions
â”œâ”€â”€ on-context-limit.py    # Memory flush before compaction
â””â”€â”€ on-project-mention.py  # Load project AGENTS.md</code></pre>
                </div>

                <h3>Hook Interface</h3>
                <div class="code-block">
                    <div class="code-header">hooks/on-daily-entry.py</div>
                    <pre><code>from parachute.hooks import Hook, context

class OnDailyEntry(Hook):
    """Triggered when a new journal entry is created."""

    event = "daily.entry.created"

    async def run(self, entry_id: str, content: str):
        # Detect mentions and link to Brain
        mentions = await context.brain.suggest(content)

        for mention in mentions:
            if mention.confidence > 0.8:
                await context.brain.link(entry_id, mention.para_id)

        # Maybe trigger reflection if conditions met
        if self.should_reflect(content):
            await context.daily.trigger_reflection(entry_id)</code></pre>
                </div>

                <h3>Hook Events</h3>
                <table class="docs-table">
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Trigger</th>
                            <th>Context Provided</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>session.start</code></td>
                            <td>New chat/daily session begins</td>
                            <td>session_id, module, working_directory</td>
                        </tr>
                        <tr>
                            <td><code>session.end</code></td>
                            <td>Session closes or times out</td>
                            <td>session_id, message_count, duration</td>
                        </tr>
                        <tr>
                            <td><code>daily.entry.created</code></td>
                            <td>New journal entry saved</td>
                            <td>entry_id, content, audio_path</td>
                        </tr>
                        <tr>
                            <td><code>context.limit.approaching</code></td>
                            <td>Context window 80% full</td>
                            <td>session_id, token_count, threshold</td>
                        </tr>
                        <tr>
                            <td><code>brain.mention.detected</code></td>
                            <td>Entity mentioned in text</td>
                            <td>source_id, para_id, confidence</td>
                        </tr>
                    </tbody>
                </table>

                <div class="callout callout-info">
                    <strong>vs. Curator:</strong> Hooks are user-configurable and event-driven. The current curator approach becomes a default hook that users can modify or replace.
                </div>
            </section>

            <!-- Migration Plan -->
            <section class="docs-section" id="migration">
                <h2>Migration Plan</h2>
                <p>Aggressive 1-2 week sprint to restructure. Testing with a separate server instance and unique Flutter app on a sample vault.</p>

                <div class="callout callout-info">
                    <strong>Approach:</strong> Full restructure in one focused push rather than incremental migration. Parallel development on separate test environment.
                </div>

                <div class="phase-card">
                    <h4>
                        <span class="phase-number">1</span>
                        Core &amp; Module System
                        <span class="phase-weeks">Days 1-3</span>
                    </h4>
                    <p>Build the foundation and module infrastructure.</p>
                    <ul>
                        <li>Create <code>parachute.core</code> Python package (SDK wrapper, permissions, database)</li>
                        <li>Define Module base class with route/MCP/event decorators</li>
                        <li>Implement module discovery from <code>modules.yaml</code></li>
                        <li>Set up hooks system (<code>.hooks/</code> directory)</li>
                    </ul>
                </div>

                <div class="phase-card">
                    <h4>
                        <span class="phase-number">2</span>
                        Core Modules
                        <span class="phase-weeks">Days 4-6</span>
                    </h4>
                    <p>Daily, Chat, and Brain as proper modules.</p>
                    <ul>
                        <li>Refactor Daily as module with <code>/api/daily/*</code> routes</li>
                        <li>Refactor Chat as module with <code>/api/chat/*</code> routes</li>
                        <li>Create Brain module (dynamic entity types, search, linking)</li>
                        <li>Implement event bus + Daily â†’ Brain integration</li>
                    </ul>
                </div>

                <div class="phase-card">
                    <h4>
                        <span class="phase-number">3</span>
                        Flutter Packages
                        <span class="phase-weeks">Days 7-9</span>
                    </h4>
                    <p>Modular Flutter architecture.</p>
                    <ul>
                        <li>Extract <code>parachute_core</code> Flutter package</li>
                        <li>Create <code>parachute_daily</code> and <code>parachute_chat</code> packages</li>
                        <li>Build standalone Daily app targeting new module API</li>
                        <li>Verify end-to-end on test vault</li>
                    </ul>
                </div>

                <div class="phase-card">
                    <h4>
                        <span class="phase-number">4</span>
                        Sandboxing &amp; Polish
                        <span class="phase-weeks">Days 10-14</span>
                    </h4>
                    <p>Security, isolation, and production readiness.</p>
                    <ul>
                        <li>Dockerize base server with volume mounts</li>
                        <li>Permission enforcement in main container (trusted modules)</li>
                        <li>Separate container setup for untrusted modules</li>
                        <li>Computer management UI (if time permits, otherwise Phase 2)</li>
                    </ul>
                </div>
            </section>

            <!-- Open Questions -->
            <section class="docs-section" id="questions">
                <h2>Open Questions</h2>
                <p>Decisions needed before/during implementation.</p>

                <h3>Architecture</h3>
                <ol class="question-list">
                    <li><strong>Module hot-reload:</strong> Can modules be updated without server restart?</li>
                    <li><strong>Module versioning:</strong> How do we handle breaking changes in module interfaces?</li>
                    <li><strong>Shared state:</strong> Should modules share a database, or each have their own?</li>
                    <li><strong>Agent context:</strong> How do we manage system prompts across modules?</li>
                </ol>

                <h3>Brain Module</h3>
                <ol class="question-list" start="5">
                    <li><strong>Entity types:</strong> Is PARA (Projects, Areas, Resources, Archive) + People sufficient?</li>
                    <li><strong>Relationship types:</strong> Should relationships be typed (collaborator, advisor) or freeform?</li>
                    <li><strong>External sync:</strong> How to import from Obsidian, Notion, etc.?</li>
                </ol>

                <h3>Sandboxing</h3>
                <ol class="question-list" start="8">
                    <li><strong>Container overhead:</strong> Is per-module Docker too heavy? Consider gVisor, Firecracker?</li>
                    <li><strong>Claude API access:</strong> Should user modules have direct Claude access or go through core?</li>
                    <li><strong>Network policies:</strong> How granular should outbound network restrictions be?</li>
                </ol>

                <h3>Flutter</h3>
                <ol class="question-list" start="11">
                    <li><strong>Package distribution:</strong> How do we distribute <code>parachute_core</code> to third-party developers?</li>
                    <li><strong>Feature flags:</strong> How do optional features (transcription) get included/excluded?</li>
                    <li><strong>Theme customization:</strong> Per-module theming, or unified across all apps?</li>
                </ol>
            </section>

            <!-- Navigation -->
            <div class="nav-cards">
                <a href="index.html" class="nav-card">
                    <h3>Current Architecture</h3>
                    <p>Understand the existing system before the restructure.</p>
                </a>
                <a href="file-manifest.html" class="nav-card">
                    <h3>File Manifest</h3>
                    <p>Complete listing of all 256 source files to be reorganized.</p>
                </a>
            </div>
        </main>
    </div>
    <footer>
        <p>&copy; 2026 Open Parachute, PBC. A Colorado Public Benefit Corporation.</p>
        <p>PRD last updated: January 29, 2026</p>
    </footer>
</body>
</html>
